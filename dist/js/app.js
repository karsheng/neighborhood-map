function initMap(){var styles=[{featureType:"water",stylers:[{color:"#19a0d8"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:6}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#e85113"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efe9e4"},{lightness:-40}]},{featureType:"transit.station",stylers:[{weight:9},{hue:"#e85113"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{lightness:100}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{lightness:-100}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"on"},{color:"#f0e4d3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#efe9e4"},{lightness:-25}]}];map=new google.maps.Map(document.getElementById("map"),{center:{lat:40.7413549,lng:-73.9980244},zoom:13,styles:styles,mapTypeControl:!1});var searchBox=new google.maps.places.SearchBox(document.getElementById("places-search"));searchBox.addListener("places_changed",function(){searchBoxPlaces(this)}),document.getElementById("go-places").addEventListener("click",textSearchPlaces),createMarkersForPlaces(initialPlaces),showPlaces()}function showPlaces(){for(var bounds=new google.maps.LatLngBounds,i=0;i<placeMarkers.length;i++)placeMarkers[i].setMap(map),bounds.extend(placeMarkers[i].position);map.fitBounds(bounds)}function hideMarkers(markers){for(var i=0;i<markers.length;i++)markers[i].setMap(null)}function hideMarker(marker){marker.setMap(null)}function showMarker(marker){marker.setMap(map)}function searchBoxPlaces(searchBox){hideMarkers(placeMarkers);var places=searchBox.getPlaces();0===places.length?window.alert("We did not find any places matching that search!"):createMarkersForPlaces(places)}function textSearchPlaces(){hideMarkers(placeMarkers);var placesService=new google.maps.places.PlacesService(map);placesService.textSearch({query:document.getElementById("places-search").value},function(results,status){status===google.maps.places.PlacesServiceStatus.OK&&createMarkersForPlaces(results)})}function createMarkersForPlaces(places){var bounds=new google.maps.LatLngBounds,placeInfoWindow=new google.maps.InfoWindow;model.placeList.removeAll();for(var i=0;i<places.length;i++){var place=places[i],icon={url:place.icon,size:new google.maps.Size(35,35),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,34),scaledSize:new google.maps.Size(35,35)},marker=new google.maps.Marker({map:map,icon:icon,title:place.name,position:place.geometry.location,id:place.place_id});storePlaceInfo(marker,placeInfoWindow,place),marker.addListener("click",function(){placeInfoWindow.marker==this?console.log("This infowindow already is on this marker!"):(model.markerClicked(this),bounceMarker(this,2e3),getPlacesDetails(this,placeInfoWindow))}),placeMarkers.push(marker),place.geometry.viewport?bounds.union(place.geometry.viewport):"function"==typeof place.geometry.location.lat&&bounds.extend(place.geometry.location)}map.fitBounds(bounds),model.filter()}function storePlaceInfo(marker,infoWindow,place){var placeOfInterest=new Place,openingHours=place.opening_hours;place.name&&(placeOfInterest.title=place.name),place.formatted_address&&(placeOfInterest.formattedAddress=place.formatted_address),"undefined"!=typeof openingHours&&openingHours.open_now&&placeOfInterest.openNow(!0),place.rating&&(placeOfInterest.rating=place.rating),placeOfInterest.placeInfoWindow=infoWindow,placeOfInterest.marker=marker,model.placeList.push(placeOfInterest)}function getPlacesDetails(marker,infowindow){var innerHTML='<div id="place-details">',service=new google.maps.places.PlacesService(map);service.getDetails({placeId:marker.id},function(place,status){status===google.maps.places.PlacesServiceStatus.OK?(infowindow.marker=marker,place.name&&(innerHTML+="<strong>"+place.name+"</strong>"),place.formatted_address&&(innerHTML+="<br>"+place.formatted_address),place.formatted_phone_number&&(innerHTML+="<br>"+place.formatted_phone_number),place.opening_hours&&(innerHTML+="<br><br><strong>Hours:</strong><br>"+place.opening_hours.weekday_text[0]+"<br>"+place.opening_hours.weekday_text[1]+"<br>"+place.opening_hours.weekday_text[2]+"<br>"+place.opening_hours.weekday_text[3]+"<br>"+place.opening_hours.weekday_text[4]+"<br>"+place.opening_hours.weekday_text[5]+"<br>"+place.opening_hours.weekday_text[6],innerHTML+=place.opening_hours.open_now?"<br><p><strong>Open Now</strong></p>":"<br><p><strong>Closed</strong></p>"),place.rating&&(innerHTML+="<br> Rating: "+place.rating),place.photos&&(innerHTML+='<br><br><img src="'+place.photos[0].getUrl({maxHeight:100,maxWidth:200})+'">'),innerHTML+="</div>",infowindow.setContent(innerHTML),infowindow.open(map,marker),infowindow.addListener("closeclick",function(){infowindow.marker=null})):(innerHTML+="Unable to retrieve details. Please try again later.</div>",infowindow.setContent(innerHTML),infowindow.open(map,marker),infowindow.addListener("closeclick",function(){infowindow.marker=null}))});var lat=marker.position.lat(),lng=marker.position.lng();const CLIENT_ID="JIYGMSOKDZCP1QPVHIHQWZ3E1JIHFOQ2IAVV41W5ENUMHRT2",CLIENT_SECRET="P1VKASPXQRIFDNGB42XFA1QMSXSKDAXJ5FFCSJJSBEB44OH0";var foursquareUrl="https://api.foursquare.com/v2/venues/search?client_id="+CLIENT_ID+"&client_secret="+CLIENT_SECRET+"&ll="+lat+","+lng+"&v=20130815&query="+marker.title;$.getJSON(foursquareUrl).done(function(data){var venue=data.response.venues[0];if(venue){var content='<div id="foursquare-details"><br>Foursquare Check-Ins: '+venue.stats.checkinsCount+"</div>";$("#place-details").append(content)}}).fail(function(e){alert("Oops sorry! Something went wrong while we tried to retrieve information from Foursquare.")})}function bounceMarker(marker,timeout){marker.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(){marker.setAnimation(null)},timeout)}var Place=function(){this.title=ko.observable(),this.formattedAddress=ko.observable(),this.marker="",this.openNow=ko.observable(!1),this.show=ko.observable(!0),this.rating=0,this.placeInfoWindow="",this.selected=ko.observable(!1)},initialPlaces=[{icon:"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png",name:"Best Pizza",geometry:{location:{lat:40.71557980000001,lng:-73.95341229999997}},place_id:"ChIJzWhpTVlZwokRRyrw-O4FIxI"},{icon:"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png",name:"Joe's Pizza",geometry:{location:{lat:40.730559,lng:-74.00216799999998}},place_id:"ChIJ8Q2WSpJZwokRQz-bYYgEskM"},{icon:"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png",name:"Lombardi's Pizza",geometry:{location:{lat:40.72153319999999,lng:-73.99563440000003}},place_id:"ChIJp-cWE4pZwokRmUI8_BIF8dg"},{icon:"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png",name:"John's of Times Square",geometry:{location:{lat:40.7582256,lng:-73.98837789999999}},place_id:"ChIJBSESh1RYwokRyHcVnrG7JWo"},{icon:"https://maps.gstatic.com/mapfiles/place_api/icons/restaurant-71.png",name:"Angelo's Coal Oven Pizzeria",geometry:{location:{lat:40.7648918,lng:-73.97797450000002}},place_id:"ChIJVTtHRfdYwokRnbMmdpG2Mw0"}],ViewModel=function(){var self=this;this.currentlySelectedPlace=null,this.placeList=ko.observableArray([]),this.placeListClicked=function(){var order=self.placeList().indexOf(this),selectedPlace=self.placeList()[order];selectedPlace.placeInfoWindow.marker==selectedPlace.marker?console.log("This infowindow already is on this marker!"):(self.highlightSelectedPlace(selectedPlace),bounceMarker(selectedPlace.marker,2e3),getPlacesDetails(selectedPlace.marker,selectedPlace.placeInfoWindow))},this.markerClicked=function(marker){ko.utils.arrayForEach(self.placeList(),function(place){marker===place.marker&&self.highlightSelectedPlace(place)})},this.textFilter=ko.observable(""),this.openNowIsChecked=ko.observable(),this.selectedRating=ko.observable(),this.openNowIsChecked.subscribe(function(){this.filter()},this),this.selectedRating.subscribe(function(){this.filter()},this),this.textFilter.subscribe(function(){this.filter()},this),this.filter=function(){var filterText=self.textFilter().toLowerCase();self.openNowIsChecked()?ko.utils.arrayForEach(self.placeList(),function(place){place.openNow()&&place.rating>=self.selectedRating()&&place.title.toLowerCase().indexOf(filterText)>=0?(place.show(!0),showMarker(place.marker)):(place.show(!1),hideMarker(place.marker))}):ko.utils.arrayForEach(self.placeList(),function(place){place.rating>=self.selectedRating()&&place.title.toLowerCase().indexOf(filterText)>=0?(place.show(!0),showMarker(place.marker)):(place.show(!1),hideMarker(place.marker))})},this.highlightSelectedPlace=function(selectedPlace){self.currentlySelectedPlace&&self.currentlySelectedPlace.selected(!1),selectedPlace.selected(!0),self.currentlySelectedPlace=selectedPlace}},model=new ViewModel;ko.applyBindings(model);var map,placeMarkers=[],menu=$("#menu"),main=$("main"),drawer=$("#drawer");menu.on("click",function(e){drawer.toggleClass("open"),menu.toggleClass("open"),e.stopPropagation()}),main.on("click",function(){drawer.removeClass("open"),menu.removeClass("open")});